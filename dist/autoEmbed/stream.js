var module={exports:exports},__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0,exports.getWebstreamerStream=getWebstreamerStream,exports.getRiveStream=getRiveStream;var getStream=_a=>__awaiter(void 0,[_a],void 0,function*({link:id,type:type,providerContext:providerContext}){var _b,_c,_d,_e,_f,_g,_h,_j;try{const streams=[],payload=(()=>{try{return JSON.parse(id)}catch(_a2){return{tmdbId:id}}})(),tmdbId=null!==(_d=null!==(_c=null!==(_b=payload.tmdbId)&&void 0!==_b?_b:payload.id)&&void 0!==_c?_c:payload.tmdId)&&void 0!==_d?_d:"",imdbId=null!==(_e=payload.imdbId)&&void 0!==_e?_e:"",season=null!==(_f=payload.season)&&void 0!==_f?_f:"",episode=null!==(_g=payload.episode)&&void 0!==_g?_g:"",effectiveType=null!==(_j=null!==(_h=payload.type)&&void 0!==_h?_h:type)&&void 0!==_j?_j:"movie";return yield getWebstreamerStream(String(imdbId),episode,season,effectiveType,streams,providerContext),yield getRiveStream(String(tmdbId),episode,season,effectiveType,streams,providerContext),streams}catch(err){return[]}});function getWebstreamerStream(imdbId,episode,season,type,Streams,providerContext){return __awaiter(this,void 0,void 0,function*(){var _a;if(!imdbId||"undefined"===imdbId)return;const url=`https://webstreamr.hayd.uk/{"multi":"on","al":"on","de":"on","es":"on","fr":"on","hi":"on","it":"on","mx":"on","mediaFlowProxyUrl":"","mediaFlowProxyPassword":""}/stream/${type}/${imdbId}${"series"===type?`:${season}:${episode}`:""}.json`;try{null===(_a=(yield providerContext.axios.get(encodeURI(url),{timeout:3e4,headers:providerContext.commonHeaders})).data)||void 0===_a||_a.streams.forEach(source=>{const url2=null==source?void 0:source.url,name=(null==source?void 0:source.name)||"WebStreamer",qualityMatch=null==name?void 0:name.match(/(\d{3,4})p/),quality=qualityMatch?qualityMatch[1]:void 0;Streams.push({server:name,link:url2,type:type,quality:quality})})}catch(e){throw e}})}function getRiveStream(tmdId,episode,season,type,Streams,providerContext){return __awaiter(this,void 0,void 0,function*(){if(!tmdId||"undefined"===tmdId)return;const secret=generateSecretKey(tmdId),baseUrl=yield providerContext.getBaseUrl("rive"),cors=process.env.CORS_PRXY?process.env.CORS_PRXY+"?url=":"",route="series"===type?`/api/backendfetch?requestID=tvVideoProvider&id=${tmdId}&season=${season}&episode=${episode}&secretKey=${secret}&service=`:`/api/backendfetch?requestID=movieVideoProvider&id=${tmdId}&secretKey=${secret}&service=`,url=cors?cors+encodeURIComponent(baseUrl+route):baseUrl+route;yield Promise.all(["flowcast","asiacloud","humpy","primevids","shadow","hindicast","animez","aqua","yggdrasil","putafilme","ophim"].map(server=>__awaiter(this,void 0,void 0,function*(){var _a,_b;try{const res=yield providerContext.axios.get(url+server,{timeout:8e3});null===(_b=null===(_a=res.data)||void 0===_a?void 0:_a.data)||void 0===_b||_b.sources.forEach(source=>{Streams.push({server:(null==source?void 0:source.source)+"-"+(null==source?void 0:source.quality),link:null==source?void 0:source.url,type:"hls"===(null==source?void 0:source.format)?"m3u8":"mp4",quality:null==source?void 0:source.quality,headers:{referer:baseUrl}})})}catch(e){}})))})}function generateSecretKey(id){const c=["4Z7lUo","gwIVSMD","PLmz2elE2v","Z4OFV0","SZ6RZq6Zc","zhJEFYxrz8","FOm7b0","axHS3q4KDq","o9zuXQ","4Aebt","wgjjWwKKx","rY4VIxqSN","kfjbnSo","2DyrFA1M","YUixDM9B","JQvgEj0","mcuFx6JIek","eoTKe26gL","qaI9EVO1rB","0xl33btZL","1fszuAU","a7jnHzst6P","wQuJkX","cBNhTJlEOf","KNcFWhDvgT","XipDGjST","PCZJlbHoyt","2AYnMZkqd","HIpJh","KH0C3iztrG","W81hjts92","rJhAT","NON7LKoMQ","NMdY3nsKzI","t4En5v","Qq5cOQ9H","Y9nwrp","VX5FYVfsf","cE5SJG","x1vj1","HegbLe","zJ3nmt4OA","gt7rxW57dq","clIE9b","jyJ9g","B5jXjMCSx","cOzZBZTV","FTXGy","Dfh1q1","ny9jqZ2POI","X2NnMn","MBtoyD","qz4Ilys7wB","68lbOMye","3YUJnmxp","1fv5Imona","PlfvvXD7mA","ZarKfHCaPR","owORnX","dQP1YU","dVdkx","qgiK0E","cx9wQ","5F9bGa","7UjkKrp","Yvhrj","wYXez5Dg3","pG4GMU","MwMAu","rFRD5wlM"];if(void 0===id)return"rive";try{let t,n;const r=String(id);if(isNaN(Number(id))){const sum=r.split("").reduce((e,ch)=>e+ch.charCodeAt(0),0);t=c[sum%c.length]||btoa(r),n=Math.floor(sum%r.length/2)}else{const num=Number(id);t=c[num%c.length]||btoa(r),n=Math.floor(num%r.length/2)}const i=r.slice(0,n)+t+r.slice(n),o=(e=>{const t2=String(e);let n2=(3735928559^t2.length)>>>0;for(let idx=0;idx<t2.length;idx++){let r2=t2.charCodeAt(idx);r2^=255&(131*idx+89^r2<<idx%5),n2=(n2<<7|n2>>>25)>>>0^r2;n2=(60205*(65535&n2)>>>0)+(60205*(n2>>>16)<<16>>>0)>>>0,n2^=n2>>>11}return n2^=n2>>>15,n2=49842*(65535&n2)+(49842*(n2>>>16)<<16)>>>0>>>0,n2^=n2>>>13,n2=40503*(65535&n2)+(40503*(n2>>>16)<<16)>>>0>>>0,n2^=n2>>>16,n2=10196*(65535&n2)+(10196*(n2>>>16)<<16)>>>0>>>0,n2^=n2>>>15,n2.toString(16).padStart(8,"0")})((e=>{e=String(e);let t2=0;for(let n2=0;n2<e.length;n2++){const r2=e.charCodeAt(n2),i2=((t2=r2+(t2<<6)+(t2<<16)-t2>>>0)<<n2%5|t2>>>32-n2%5)>>>0;t2=(t2^i2^(r2<<n2%7|r2>>>8-n2%7)>>>0)>>>0,t2=t2+(t2>>>11^t2<<3)>>>0}return t2^=t2>>>15,t2=49842*(65535&t2)+((49842*(t2>>>16)&65535)<<16)>>>0,t2^=t2>>>13,t2=40503*(65535&t2)+((40503*(t2>>>16)&65535)<<16)>>>0,t2^=t2>>>16,t2.toString(16).padStart(8,"0")})(i));return btoa(o)}catch(e){return"topSecret"}}exports.getStream=getStream;
var module={exports:exports},__getOwnPropNames=Object.getOwnPropertyNames,__commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports},require_utils=__commonJS({"dist/animeunity/utils.js"(exports2){"use strict";Object.defineProperty(exports2,"__esModule",{value:!0}),exports2.decodeHtmlAttribute=function(value){return value.replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},exports2.normalizeImageUrl=function(url){if(!url)return"";try{const parsed=new URL(url),host=parsed.hostname.toLowerCase();if(host.includes("animeworld.so")||host.includes("forbiddenlol.cloud")){const filename=parsed.pathname.split("/").pop()||"";if(filename)return`https://img.animeunity.so/anime/${filename}`}}catch(_){return url}return url},exports2.buildAnimeLink=function(baseHost,id,slug){if(!id)return"";if(!slug)return`${baseHost}/anime/${id}`;return`${baseHost}/anime/${id}-${slug}`}}}),require_meta=__commonJS({"dist/animeunity/parsers/meta.js"(exports2){"use strict";Object.defineProperty(exports2,"__esModule",{value:!0}),exports2.extractAnimeId=function(link){if(!link)return null;const direct=parseInt(link,10);if(Number.isFinite(direct))return direct;const match=link.match(/\/anime\/(\d+)/);if(null==match?void 0:match[1]){const parsed=parseInt(match[1],10);return Number.isFinite(parsed)?parsed:null}return null},exports2.mapRelatedBase=mapRelatedBase,exports2.parseAnimeFromHtml=function(html,cheerio){const $=cheerio.load(html);let raw=$("video-player").attr("anime")||$("[anime]").first().attr("anime")||"";if(!raw){const match=html.match(/anime="([^"]+)"/);raw=(null==match?void 0:match[1])||""}if(!raw)return null;try{return JSON.parse((0,utils_12.decodeHtmlAttribute)(raw))}catch(_){return null}},exports2.buildMetaFromInfo=function(info,baseHost,animeId,animeFromHtml){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,_w;const htmlAnime=animeFromHtml&&"object"==typeof animeFromHtml?animeFromHtml:{},title=(null==info?void 0:info.title_eng)||(null==info?void 0:info.title)||(null==info?void 0:info.title_it)||(null==htmlAnime?void 0:htmlAnime.title_eng)||(null==htmlAnime?void 0:htmlAnime.title)||(null==htmlAnime?void 0:htmlAnime.title_it)||"Unknown",synopsis=(null!==(_b=null!==(_a=null==info?void 0:info.plot)&&void 0!==_a?_a:null==htmlAnime?void 0:htmlAnime.plot)&&void 0!==_b?_b:"").toString(),poster=(0,utils_12.normalizeImageUrl)((null==info?void 0:info.imageurl)||(null==info?void 0:info.cover)||(null==htmlAnime?void 0:htmlAnime.imageurl)||(null==htmlAnime?void 0:htmlAnime.cover)),background=(0,utils_12.normalizeImageUrl)((null==info?void 0:info.imageurl_cover)||(null==info?void 0:info.cover)||(null==htmlAnime?void 0:htmlAnime.imageurl_cover)||(null==htmlAnime?void 0:htmlAnime.cover)),type=null!==(_c=null==info?void 0:info.type)&&void 0!==_c?_c:null==htmlAnime?void 0:htmlAnime.type,status=null!==(_d=null==info?void 0:info.status)&&void 0!==_d?_d:null==htmlAnime?void 0:htmlAnime.status,season=null!==(_e=null==info?void 0:info.season)&&void 0!==_e?_e:null==htmlAnime?void 0:htmlAnime.season,dateValue=null!==(_f=null==info?void 0:info.date)&&void 0!==_f?_f:null==htmlAnime?void 0:htmlAnime.date,tags=uniqueTags([type,status,season,dateValue?String(dateValue):""].filter(Boolean)),genres=function(raw){if(!Array.isArray(raw))return[];return uniqueTags(raw.map(item=>function(value){if(null==value)return;if("string"==typeof value){const trimmed=value.trim();return trimmed||void 0}if("object"==typeof value){const name=value.name;if("string"==typeof name&&name.trim())return name.trim()}return}(item)).filter(Boolean))}(Array.isArray(null==info?void 0:info.genres)&&info.genres.length>0?info.genres:null==htmlAnime?void 0:htmlAnime.genres),isMovie="string"==typeof type&&type.toLowerCase().includes("movie"),episodesCountRaw=null!==(_h=null!==(_g=null==info?void 0:info.episodes_count)&&void 0!==_g?_g:null==htmlAnime?void 0:htmlAnime.episodes_count)&&void 0!==_h?_h:0,ranges=function(totalCount,rangeSize=120){if(!totalCount||totalCount<=0)return[];const ranges=[];let start=1;for(;start<=totalCount;){const end=Math.min(start+rangeSize-1,totalCount);ranges.push({title:`Episodi ${start}-${end}`,start:start,end:end}),start=end+1}return ranges}("number"==typeof episodesCountRaw?episodesCountRaw:parseInt(String(episodesCountRaw),10)||0),linkList=ranges.length?ranges.map(range=>({title:range.title,episodesLink:`${animeId}|${range.start}|${range.end}`})):[{title:title,episodesLink:String(animeId)}],relatedBase=mapRelatedBase(Array.isArray(null==htmlAnime?void 0:htmlAnime.related)&&htmlAnime.related.length>0?htmlAnime.related:(null==info?void 0:info.related)||[],baseHost);return{title:title,synopsis:synopsis,poster:poster,background:background,tags:tags,genres:genres,isMovie:isMovie,linkList:linkList,episodesCount:"number"==typeof episodesCountRaw?episodesCountRaw:parseInt(String(episodesCountRaw),10)||void 0,studio:(null==info?void 0:info.studio)||(null==htmlAnime?void 0:htmlAnime.studio)||"",rating:formatRating(null!==(_j=null==info?void 0:info.score)&&void 0!==_j?_j:null==htmlAnime?void 0:htmlAnime.score),extra:{ids:{malId:toNumber(null!==(_k=null==info?void 0:info.mal_id)&&void 0!==_k?_k:null==htmlAnime?void 0:htmlAnime.mal_id),anilistId:toNumber(null!==(_l=null==info?void 0:info.anilist_id)&&void 0!==_l?_l:null==htmlAnime?void 0:htmlAnime.anilist_id),crunchyId:null!==(_m=null==info?void 0:info.crunchy_id)&&void 0!==_m?_m:null==htmlAnime?void 0:htmlAnime.crunchy_id,disneyId:null!==(_o=null==info?void 0:info.disney_id)&&void 0!==_o?_o:null==htmlAnime?void 0:htmlAnime.disney_id,netflixId:null!==(_p=null==info?void 0:info.netflix_id)&&void 0!==_p?_p:null==htmlAnime?void 0:htmlAnime.netflix_id,primeId:null!==(_q=null==info?void 0:info.prime_id)&&void 0!==_q?_q:null==htmlAnime?void 0:htmlAnime.prime_id},stats:{scoreRaw:toStringValue(null!==(_r=null==info?void 0:info.score)&&void 0!==_r?_r:null==htmlAnime?void 0:htmlAnime.score),favorites:toNumber(null==htmlAnime?void 0:htmlAnime.favorites),members:toNumber(null==htmlAnime?void 0:htmlAnime.members),views:toNumber(null==htmlAnime?void 0:htmlAnime.visite),episodesCountRaw:null!==(_t=null!==(_s=null==info?void 0:info.episodes_count)&&void 0!==_s?_s:null==htmlAnime?void 0:htmlAnime.episodes_count)&&void 0!==_t?_t:void 0,episodesLength:null!==(_u=null==htmlAnime?void 0:htmlAnime.episodes_length)&&void 0!==_u?_u:void 0},flags:{dub:null!==(_v=null==info?void 0:info.dub)&&void 0!==_v?_v:null==htmlAnime?void 0:htmlAnime.dub,alwaysHome:null==htmlAnime?void 0:htmlAnime.always_home},meta:{day:toStringValue(null==htmlAnime?void 0:htmlAnime.day),season:toStringValue(season),status:toStringValue(status),type:toStringValue(type),createdAt:toStringValue(null==htmlAnime?void 0:htmlAnime.created_at),author:toStringValue(null==htmlAnime?void 0:htmlAnime.author),userId:null!==(_w=null==htmlAnime?void 0:htmlAnime.user_id)&&void 0!==_w?_w:void 0}},relatedBase:relatedBase}};var utils_12=require_utils();function uniqueTags(tags){const seen=new Set,result=[];return tags.forEach(tag=>{const normalized=tag.trim();normalized&&!seen.has(normalized)&&(seen.add(normalized),result.push(normalized))}),result}function formatRating(value){if(null==value)return;const text=String(value).trim().replace(",",".");if(!text)return;const parsed=Number.parseFloat(text);return Number.isFinite(parsed)?parsed.toFixed(1):void 0}function toNumber(value){if(null==value)return;if("number"==typeof value&&Number.isFinite(value))return value;const text=String(value).trim().replace(",",".");if(!text)return;const parsed=Number.parseFloat(text);return Number.isFinite(parsed)?parsed:void 0}function toStringValue(value){if(null==value)return;const text=String(value).trim();return text||void 0}function pickYear(item){var _a,_b;const raw=null!==(_b=null!==(_a=null==item?void 0:item.date)&&void 0!==_a?_a:null==item?void 0:item.year)&&void 0!==_b?_b:"";if(!raw)return;const match=String(raw).match(/(\d{4})/);return null==match?void 0:match[1]}function mapRelatedBase(items,baseHost){return Array.isArray(items)?items.map(item=>{const title=function(item){return(null==item?void 0:item.title_eng)||(null==item?void 0:item.title)||(null==item?void 0:item.title_it)||""}(item),id=null==item?void 0:item.id,slug=null==item?void 0:item.slug;return title&&id?{id:id,title:title,link:(0,utils_12.buildAnimeLink)(baseHost,id,slug),image:(0,utils_12.normalizeImageUrl)(null==item?void 0:item.imageurl),type:(null==item?void 0:item.type)||(null==item?void 0:item.relation)||(null==item?void 0:item.rel),year:pickYear(item)}:null}).filter(Boolean):[]}}}),require_config=__commonJS({"dist/animeunity/config.js"(exports2){"use strict";Object.defineProperty(exports2,"__esModule",{value:!0}),exports2.TIMEOUTS=exports2.STREAM_HEADERS=exports2.DEFAULT_HEADERS=exports2.BASE_HOST_NO_WWW=exports2.BASE_HOST=void 0,exports2.BASE_HOST="https://www.animeunity.so",exports2.BASE_HOST_NO_WWW="https://animeunity.so",exports2.DEFAULT_HEADERS={Accept:"application/json","User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"},exports2.STREAM_HEADERS={"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"},exports2.TIMEOUTS={SHORT:1e4,LONG:15e3,RELATED:6e4}}}),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;var meta_1=require_meta(),utils_1=require_utils(),config_1=require_config();function resolveRelatedImages(items,axios){return __awaiter(this,void 0,void 0,function*(){return(yield Promise.all(items.map(item=>__awaiter(this,void 0,void 0,function*(){if(item.image)return item;if(!item.id)return item;try{const detail=(yield axios.get(`${config_1.BASE_HOST}/info_api/${item.id}/`,{headers:config_1.DEFAULT_HEADERS,timeout:config_1.TIMEOUTS.RELATED})).data||{},image=(0,utils_1.normalizeImageUrl)((null==detail?void 0:detail.imageurl)||(null==detail?void 0:detail.cover)||(null==detail?void 0:detail.imageurl_cover));return Object.assign(Object.assign({},item),{image:image||item.image})}catch(_){return item}})))).map(item=>({title:item.title,link:item.link,image:item.image||"",type:item.type,year:item.year}))})}var getMeta=function(_a){return __awaiter(this,arguments,void 0,function*({link:link,providerContext:providerContext}){try{const{axios:axios,cheerio:cheerio}=providerContext,animeId=(0,meta_1.extractAnimeId)(link);if(!animeId)throw new Error("Invalid anime id");const info=(yield axios.get(`${config_1.BASE_HOST}/info_api/${animeId}/`,{headers:config_1.DEFAULT_HEADERS,timeout:config_1.TIMEOUTS.LONG})).data||{};let animeFromHtml=null;try{const htmlRes=yield axios.get(`${config_1.BASE_HOST}/anime/${animeId}-${(null==info?void 0:info.slug)||""}`,{headers:config_1.DEFAULT_HEADERS,timeout:config_1.TIMEOUTS.LONG});animeFromHtml=(0,meta_1.parseAnimeFromHtml)(htmlRes.data,cheerio)}catch(_){}const metaPayload=(0,meta_1.buildMetaFromInfo)(info,config_1.BASE_HOST,animeId,animeFromHtml),background=metaPayload.background,related=yield resolveRelatedImages(metaPayload.relatedBase,axios);return{title:metaPayload.title,synopsis:metaPayload.synopsis,image:background||metaPayload.poster,poster:metaPayload.poster,imdbId:"",type:metaPayload.isMovie?"movie":"series",tags:metaPayload.tags,genres:metaPayload.genres,rating:metaPayload.rating,studio:metaPayload.studio||"",episodesCount:metaPayload.episodesCount,extra:metaPayload.extra,related:related,linkList:metaPayload.linkList}}catch(err){return{title:"",synopsis:"",image:"",imdbId:"",type:"series",linkList:[]}}})};exports.getMeta=getMeta;
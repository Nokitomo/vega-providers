"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DEFAULT_HEADERS=exports.BASE_HOST_NO_WWW=exports.BASE_HOST=void 0,exports.decodeHtmlAttribute=decodeHtmlAttribute,exports.getSession=getSession,exports.buildSessionHeaders=buildSessionHeaders,exports.normalizeImageUrl=normalizeImageUrl,exports.buildAnimeLink=buildAnimeLink;const BASE_HOST="https://www.animeunity.so";exports.BASE_HOST=BASE_HOST;const BASE_HOST_NO_WWW="https://animeunity.so";exports.BASE_HOST_NO_WWW=BASE_HOST_NO_WWW;const DEFAULT_HEADERS={Accept:"application/json","User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"};function decodeHtmlAttribute(value){return value.replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}function extractCookieValue(raw,name){const match=new RegExp(`${name}=([^;]+)`).exec(raw);return null==match?void 0:match[1]}function getSession(axios){return __awaiter(this,void 0,void 0,function*(){var _a;try{const raw=null===(_a=(yield axios.get(`${BASE_HOST}/`,{headers:DEFAULT_HEADERS,timeout:1e4})).headers)||void 0===_a?void 0:_a["set-cookie"],cookieHeader=Array.isArray(raw)?raw.join("; "):raw||"";if(!cookieHeader)return{};const xsrf=extractCookieValue(cookieHeader,"XSRF-TOKEN"),session=extractCookieValue(cookieHeader,"animeunity_session");return{xsrfToken:xsrf?decodeURIComponent(xsrf):void 0,session:session}}catch(_){return{}}})}function buildSessionHeaders(session){const headers=Object.assign(Object.assign({},DEFAULT_HEADERS),{Origin:BASE_HOST,Referer:`${BASE_HOST}/`});session.xsrfToken&&(headers["X-XSRF-TOKEN"]=session.xsrfToken);const parts=[];return session.xsrfToken&&parts.push(`XSRF-TOKEN=${session.xsrfToken}`),session.session&&parts.push(`animeunity_session=${session.session}`),parts.length>0&&(headers.Cookie=parts.join("; ")),headers}function normalizeImageUrl(url){if(!url)return"";try{const parsed=new URL(url),host=parsed.hostname.toLowerCase();if(host.includes("animeworld.so")||host.includes("forbiddenlol.cloud")){const filename=parsed.pathname.split("/").pop()||"";if(filename)return`https://img.animeunity.so/anime/${filename}`}}catch(_){return url}return url}function buildAnimeLink(id,slug){return id?slug?`${BASE_HOST}/anime/${id}-${slug}`:`${BASE_HOST}/anime/${id}`:""}exports.DEFAULT_HEADERS=DEFAULT_HEADERS;
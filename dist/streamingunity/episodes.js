var module={exports:exports},__getOwnPropNames=Object.getOwnPropertyNames,__commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports},require_utils=__commonJS({"dist/streamingunity/utils.js"(exports2){"use strict";var __awaiter2=exports2&&exports2.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports2,"__esModule",{value:!0}),exports2.normalizeText=exports2.buildTitleUrl=exports2.extractTitleId=exports2.pickImageByType=exports2.buildImageUrl=exports2.resolveTitleSlug=exports2.resolveTitleName=exports2.getTranslationValue=exports2.extractInertiaPage=exports2.decodeHtmlEntities=exports2.buildLocaleUrl=exports2.resolveUrl=exports2.buildLocalePath=exports2.resolveBaseUrl=exports2.normalizeBaseUrl=exports2.REQUEST_TIMEOUT=exports2.DEFAULT_LOCALE=exports2.DEFAULT_BASE_URL=void 0,exports2.DEFAULT_BASE_URL="https://streamingunity.tv",exports2.DEFAULT_LOCALE="it",exports2.REQUEST_TIMEOUT=15e3;exports2.normalizeBaseUrl=value=>value.replace(/\/+$/,"");exports2.resolveBaseUrl=providerContext=>__awaiter2(void 0,void 0,void 0,function*(){try{const resolved=yield providerContext.getBaseUrl("streamingunity");if(resolved)return(0,exports2.normalizeBaseUrl)(resolved)}catch(_){}return exports2.DEFAULT_BASE_URL});exports2.buildLocalePath=path=>{const normalized=path?(value=path.trim()).startsWith("/")?value:`/${value}`:"";var value;return normalized&&"/"!==normalized?normalized.startsWith(`/${exports2.DEFAULT_LOCALE}/`)||normalized===`/${exports2.DEFAULT_LOCALE}`?normalized:`/${exports2.DEFAULT_LOCALE}${normalized}`:`/${exports2.DEFAULT_LOCALE}`};exports2.resolveUrl=(href,baseUrl)=>href?/^https?:\/\//i.test(href)?href:new URL(href,baseUrl).href:"";exports2.buildLocaleUrl=(path,baseUrl)=>(0,exports2.resolveUrl)((0,exports2.buildLocalePath)(path),baseUrl);exports2.decodeHtmlEntities=value=>value.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");exports2.extractInertiaPage=(html,cheerio)=>{if(!html)return null;const $=cheerio.load(html),raw=$("#app[data-page]").first().attr("data-page")||$("div[data-page]").first().attr("data-page")||"";if(!raw)return null;const decoded=(0,exports2.decodeHtmlEntities)(raw);try{return JSON.parse(decoded)}catch(_){try{return JSON.parse((0,exports2.decodeHtmlEntities)(decoded))}catch(err){return null}}};exports2.getTranslationValue=(translations,key,locale=exports2.DEFAULT_LOCALE)=>{if(!Array.isArray(translations))return"";const match=translations.find(item=>item&&item.key===key&&item.locale===locale);return(null==match?void 0:match.value)?String(match.value).trim():""};exports2.resolveTitleName=(title,locale=exports2.DEFAULT_LOCALE)=>{const normalizeComparable=value=>(0,exports2.normalizeText)(value).toLowerCase(),translations=null==title?void 0:title.translations,original=String((null==title?void 0:title.name)||(null==title?void 0:title.original_name)||"").trim(),isValidTranslated=value=>{if(!value)return!1;if(!original)return!0;const sameAsOriginal=normalizeComparable(value)===normalizeComparable(original);return(!sameAsOriginal||!(value=>/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff]/.test(value))(value))&&(!sameAsOriginal||(value=>/[A-Za-zÀ-ÖØ-öø-ÿ]/.test(value))(value))},translated=(0,exports2.getTranslationValue)(translations,"name",locale);if(isValidTranslated(translated))return translated;if("en"!==locale){const english=(0,exports2.getTranslationValue)(translations,"name","en");if(isValidTranslated(english))return english}const normalizedSlug=(value=>{const raw=String(value||"").trim();if(!raw)return"";const normalized=raw.replace(/[-_]+/g," ").replace(/\s+/g," ").trim();return normalized?normalized.split(" ").map(word=>word?word[0].toUpperCase()+word.slice(1):"").join(" "):""})((0,exports2.getTranslationValue)(translations,"slug",locale)||(0,exports2.getTranslationValue)(translations,"slug","en")||String((null==title?void 0:title.slug)||"").trim());return normalizedSlug||original};exports2.resolveTitleSlug=(title,locale=exports2.DEFAULT_LOCALE)=>(0,exports2.getTranslationValue)(null==title?void 0:title.translations,"slug",locale)||String((null==title?void 0:title.slug)||"").trim();exports2.buildImageUrl=(image,cdnUrl)=>{if(!image)return"";const raw=image.original_url_field||image.url||image.src||image.path||image.filename||"";if(!raw)return"";if(/^https?:\/\//i.test(raw))return raw;const normalizedCdn=cdnUrl?cdnUrl.replace(/\/+$/,""):"";return normalizedCdn?`${normalizedCdn}/images/${String(raw).replace(/^\/+/,"")}`:raw};exports2.pickImageByType=(images,cdnUrl,types,locale=exports2.DEFAULT_LOCALE)=>{if(!Array.isArray(images)||0===images.length)return"";const normalizedTypes=types.map(type=>type.toLowerCase());for(const type of normalizedTypes){const matches=images.filter(img=>String((null==img?void 0:img.type)||"").toLowerCase()===type);if(0===matches.length)continue;const fallback2=matches.find(img=>String((null==img?void 0:img.lang)||"").toLowerCase()===locale)||matches.find(img=>!(null==img?void 0:img.lang))||matches[0],url=(0,exports2.buildImageUrl)(fallback2,cdnUrl);if(url)return url}const fallback=images[0];return(0,exports2.buildImageUrl)(fallback,cdnUrl)};exports2.extractTitleId=value=>{if(!value)return"";const cleaned=value.split("::")[0],match=cleaned.match(/\/(?:titles|watch)\/(\d+)/i)||cleaned.match(/^(\d+)$/);return(null==match?void 0:match[1])||""};exports2.buildTitleUrl=(titleId,slug,baseUrl)=>{const id=String(titleId||"").trim();if(!id)return"";const safeSlug=slug?`-${slug}`:"";return(0,exports2.buildLocaleUrl)(`/titles/${id}${safeSlug}`,baseUrl)};exports2.normalizeText=value=>String(value||"").replace(/\s+/g," ").trim()}}),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getEpisodes=void 0;var utils_1=require_utils(),fetchHtml=(url,providerContext)=>__awaiter(void 0,void 0,void 0,function*(){var _a;const{axios:axios,commonHeaders:commonHeaders}=providerContext,res=yield axios.get(url,{headers:Object.assign(Object.assign({},commonHeaders),{Referer:url}),timeout:utils_1.REQUEST_TIMEOUT});return"string"==typeof res.data?res.data:String(null!==(_a=res.data)&&void 0!==_a?_a:"")}),toSeasonNumber=value=>{const parsed=Number(value);if(Number.isFinite(parsed)&&!(parsed<=0))return Math.floor(parsed)},parseSeasonNumberFromUrl=url=>{const match=String(url||"").match(/\/season-(\d+)\b/i);if(null==match?void 0:match[1])return toSeasonNumber(match[1])},mapEpisodes=(episodes,titleId,seasonNumber)=>Array.isArray(episodes)&&0!==episodes.length&&titleId?episodes.map(episode=>{const episodeId=String((null==episode?void 0:episode.id)||"").trim();if(!episodeId)return null;const rawNumber=null!=(null==episode?void 0:episode.number)?String(episode.number):"",parsedEpisodeNumber=Number.parseInt(rawNumber,10),translatedName=(0,utils_1.getTranslationValue)(null==episode?void 0:episode.translations,"name",utils_1.DEFAULT_LOCALE),name=(0,utils_1.normalizeText)(translatedName||(null==episode?void 0:episode.name)||""),titleKey=!name&&rawNumber?"Episode {{number}}":void 0;return{title:name||(rawNumber?`Episode ${rawNumber}`:"Episode"),titleKey:titleKey,titleParams:titleKey?{number:rawNumber}:void 0,episodeNumber:Number.isFinite(parsedEpisodeNumber)?parsedEpisodeNumber:void 0,seasonNumber:seasonNumber,link:`${titleId}::${episodeId}`}}).filter(episode=>!!episode&&!!episode.link):[],getEpisodes=function(_a){return __awaiter(this,arguments,void 0,function*({url:url,providerContext:providerContext}){var _b,_c,_d;try{const baseUrl=yield(0,utils_1.resolveBaseUrl)(providerContext),seasonUrl=(0,utils_1.resolveUrl)(url,baseUrl);if(!seasonUrl)return[];const html=yield fetchHtml(seasonUrl,providerContext),page=(0,utils_1.extractInertiaPage)(html,providerContext.cheerio),titleId=String((null===(_c=null===(_b=null==page?void 0:page.props)||void 0===_b?void 0:_b.title)||void 0===_c?void 0:_c.id)||(0,utils_1.extractTitleId)(seasonUrl)||"").trim();if(!titleId)return[];const loadedSeason=null===(_d=null==page?void 0:page.props)||void 0===_d?void 0:_d.loadedSeason,seasonNumber=toSeasonNumber(null==loadedSeason?void 0:loadedSeason.number)||parseSeasonNumberFromUrl(seasonUrl),episodes=Array.isArray(null==loadedSeason?void 0:loadedSeason.episodes)?loadedSeason.episodes:[];return mapEpisodes(episodes,titleId,seasonNumber)}catch(err){return[]}})};exports.getEpisodes=getEpisodes;
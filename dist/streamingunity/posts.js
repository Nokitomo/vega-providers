var module={exports:exports},__getOwnPropNames=Object.getOwnPropertyNames,__commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports},require_utils=__commonJS({"dist/streamingunity/utils.js"(exports2){"use strict";var __awaiter2=exports2&&exports2.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports2,"__esModule",{value:!0}),exports2.normalizeText=exports2.buildTitleUrl=exports2.extractTitleId=exports2.pickImageByType=exports2.buildImageUrl=exports2.resolveTitleSlug=exports2.resolveTitleName=exports2.getTranslationValue=exports2.extractInertiaPage=exports2.decodeHtmlEntities=exports2.buildLocaleUrl=exports2.resolveUrl=exports2.buildLocalePath=exports2.resolveBaseUrl=exports2.normalizeBaseUrl=exports2.REQUEST_TIMEOUT=exports2.DEFAULT_LOCALE=exports2.DEFAULT_BASE_URL=void 0,exports2.DEFAULT_BASE_URL="https://streamingunity.tv",exports2.DEFAULT_LOCALE="it",exports2.REQUEST_TIMEOUT=15e3;exports2.normalizeBaseUrl=value=>value.replace(/\/+$/,"");exports2.resolveBaseUrl=providerContext=>__awaiter2(void 0,void 0,void 0,function*(){try{const resolved=yield providerContext.getBaseUrl("streamingunity");if(resolved)return(0,exports2.normalizeBaseUrl)(resolved)}catch(_){}return exports2.DEFAULT_BASE_URL});exports2.buildLocalePath=path=>{const normalized=path?(value=path.trim()).startsWith("/")?value:`/${value}`:"";var value;return normalized&&"/"!==normalized?normalized.startsWith(`/${exports2.DEFAULT_LOCALE}/`)||normalized===`/${exports2.DEFAULT_LOCALE}`?normalized:`/${exports2.DEFAULT_LOCALE}${normalized}`:`/${exports2.DEFAULT_LOCALE}`};exports2.resolveUrl=(href,baseUrl)=>href?/^https?:\/\//i.test(href)?href:new URL(href,baseUrl).href:"";exports2.buildLocaleUrl=(path,baseUrl)=>(0,exports2.resolveUrl)((0,exports2.buildLocalePath)(path),baseUrl);exports2.decodeHtmlEntities=value=>value.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");exports2.extractInertiaPage=(html,cheerio)=>{if(!html)return null;const $=cheerio.load(html),raw=$("#app[data-page]").first().attr("data-page")||$("div[data-page]").first().attr("data-page")||"";if(!raw)return null;const decoded=(0,exports2.decodeHtmlEntities)(raw);try{return JSON.parse(decoded)}catch(_){try{return JSON.parse((0,exports2.decodeHtmlEntities)(decoded))}catch(err){return null}}};exports2.getTranslationValue=(translations,key,locale=exports2.DEFAULT_LOCALE)=>{if(!Array.isArray(translations))return"";const match=translations.find(item=>item&&item.key===key&&item.locale===locale);return(null==match?void 0:match.value)?String(match.value).trim():""};exports2.resolveTitleName=(title,locale=exports2.DEFAULT_LOCALE)=>{const normalizeComparable=value=>(0,exports2.normalizeText)(value).toLowerCase(),translations=null==title?void 0:title.translations,original=String((null==title?void 0:title.name)||(null==title?void 0:title.original_name)||"").trim(),isValidTranslated=value=>{if(!value)return!1;if(!original)return!0;const sameAsOriginal=normalizeComparable(value)===normalizeComparable(original);return(!sameAsOriginal||!(value=>/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff]/.test(value))(value))&&(!sameAsOriginal||(value=>/[A-Za-zÀ-ÖØ-öø-ÿ]/.test(value))(value))},translated=(0,exports2.getTranslationValue)(translations,"name",locale);if(isValidTranslated(translated))return translated;if("en"!==locale){const english=(0,exports2.getTranslationValue)(translations,"name","en");if(isValidTranslated(english))return english}const normalizedSlug=(value=>{const raw=String(value||"").trim();if(!raw)return"";const normalized=raw.replace(/[-_]+/g," ").replace(/\s+/g," ").trim();return normalized?normalized.split(" ").map(word=>word?word[0].toUpperCase()+word.slice(1):"").join(" "):""})((0,exports2.getTranslationValue)(translations,"slug",locale)||(0,exports2.getTranslationValue)(translations,"slug","en")||String((null==title?void 0:title.slug)||"").trim());return normalizedSlug||original};exports2.resolveTitleSlug=(title,locale=exports2.DEFAULT_LOCALE)=>(0,exports2.getTranslationValue)(null==title?void 0:title.translations,"slug",locale)||String((null==title?void 0:title.slug)||"").trim();exports2.buildImageUrl=(image,cdnUrl)=>{if(!image)return"";const raw=image.original_url_field||image.url||image.src||image.path||image.filename||"";if(!raw)return"";if(/^https?:\/\//i.test(raw))return raw;const normalizedCdn=cdnUrl?cdnUrl.replace(/\/+$/,""):"";return normalizedCdn?`${normalizedCdn}/images/${String(raw).replace(/^\/+/,"")}`:raw};exports2.pickImageByType=(images,cdnUrl,types,locale=exports2.DEFAULT_LOCALE)=>{if(!Array.isArray(images)||0===images.length)return"";const normalizedTypes=types.map(type=>type.toLowerCase());for(const type of normalizedTypes){const matches=images.filter(img=>String((null==img?void 0:img.type)||"").toLowerCase()===type);if(0===matches.length)continue;const fallback2=matches.find(img=>String((null==img?void 0:img.lang)||"").toLowerCase()===locale)||matches.find(img=>!(null==img?void 0:img.lang))||matches[0],url=(0,exports2.buildImageUrl)(fallback2,cdnUrl);if(url)return url}const fallback=images[0];return(0,exports2.buildImageUrl)(fallback,cdnUrl)};exports2.extractTitleId=value=>{if(!value)return"";const cleaned=value.split("::")[0],match=cleaned.match(/\/(?:titles|watch)\/(\d+)/i)||cleaned.match(/^(\d+)$/);return(null==match?void 0:match[1])||""};exports2.buildTitleUrl=(titleId,slug,baseUrl)=>{const id=String(titleId||"").trim();if(!id)return"";const safeSlug=slug?`-${slug}`:"";return(0,exports2.buildLocaleUrl)(`/titles/${id}${safeSlug}`,baseUrl)};exports2.normalizeText=value=>String(value||"").replace(/\s+/g," ").trim()}}),require_filters=__commonJS({"dist/streamingunity/filters.js"(exports2){"use strict";Object.defineProperty(exports2,"__esModule",{value:!0}),exports2.normalizeArchiveAge=exports2.normalizeArchiveQuality=exports2.normalizeArchiveService=exports2.normalizeArchiveViews=exports2.normalizeArchiveScore=exports2.normalizeArchiveYear=exports2.normalizeArchiveGenre=exports2.normalizeArchiveType=exports2.normalizeArchiveSort=exports2.ARCHIVE_YEAR_OPTIONS=exports2.buildArchiveYears=exports2.ARCHIVE_YEAR_MIN=exports2.ARCHIVE_GENRES=exports2.ARCHIVE_AGE_OPTIONS=exports2.ARCHIVE_QUALITY_OPTIONS=exports2.ARCHIVE_SERVICE_OPTIONS=exports2.ARCHIVE_VIEWS_OPTIONS=exports2.ARCHIVE_SCORE_OPTIONS=exports2.ARCHIVE_TYPE_OPTIONS=exports2.ARCHIVE_SORT_OPTIONS=void 0,exports2.ARCHIVE_SORT_OPTIONS=[{title:"Release date",titleKey:"Release date",value:"release_date",providerValue:"Data di uscita"},{title:"Last air date",titleKey:"Last air date",value:"last_air_date",providerValue:"Data di aggiornamento"},{title:"Date added",titleKey:"Date added",value:"created_at",providerValue:"Data di aggiunta"},{title:"Score",titleKey:"Score",value:"score",providerValue:"Valutazione"},{title:"Views",titleKey:"Views",value:"views",providerValue:"Views"},{title:"Name",titleKey:"Name",value:"name",providerValue:"Nome"}],exports2.ARCHIVE_TYPE_OPTIONS=[{title:"TV Show",titleKey:"TV Show",value:"tv",providerValue:"Serie TV"},{title:"Movie",titleKey:"Movie",value:"movie",providerValue:"Film"}],exports2.ARCHIVE_SCORE_OPTIONS=Array.from({length:10},(_,index)=>{const value=index+1;return{title:String(value),value:value}}),exports2.ARCHIVE_VIEWS_OPTIONS=[{title:"25k+",value:25e3},{title:"50k+",value:5e4},{title:"75k+",value:75e3},{title:"100k+",value:1e5},{title:"250k+",value:25e4},{title:"500k+",value:5e5},{title:"1M+",value:1e6},{title:"2M+",value:2e6},{title:"5M+",value:5e6},{title:"10M+",value:1e7}],exports2.ARCHIVE_SERVICE_OPTIONS=[{title:"Netflix",value:"netflix",providerValue:"Netflix"},{title:"PrimeVideo",value:"prime",providerValue:"PrimeVideo"},{title:"Disney+",value:"disney",providerValue:"Disney+"},{title:"AppleTV+",value:"apple",providerValue:"AppleTV+"},{title:"NowTV",value:"now",providerValue:"NowTV"},{title:"HBOMax",value:"hbo",providerValue:"HBOMax"}],exports2.ARCHIVE_QUALITY_OPTIONS=[{title:"HD",value:"HD",providerValue:"HD"},{title:"SD",value:"SD",providerValue:"SD"},{title:"TS",value:"TS",providerValue:"TS"},{title:"CAM",value:"CAM",providerValue:"CAM"}],exports2.ARCHIVE_AGE_OPTIONS=[{title:"7+",value:7},{title:"12+",value:12},{title:"14+",value:14},{title:"16+",value:16},{title:"18+",value:18}],exports2.ARCHIVE_GENRES=[{id:4,name:"Azione",title:"Action",titleKey:"Action",type:"movie"},{id:13,name:"Action & Adventure",title:"Action & Adventure",titleKey:"Action & Adventure",type:"tv"},{id:11,name:"Avventura",title:"Adventure",titleKey:"Adventure",type:"movie"},{id:19,name:"Animazione",title:"Animation",titleKey:"Animation",type:"all"},{id:12,name:"Commedia",title:"Comedy",titleKey:"Comedy",type:"all"},{id:2,name:"Crime",title:"Crime",titleKey:"Crime",type:"all"},{id:24,name:"Documentario",title:"Documentary",titleKey:"Documentary",type:"all"},{id:1,name:"Dramma",title:"Drama",titleKey:"Drama",type:"all"},{id:16,name:"Famiglia",title:"Family",titleKey:"Family",type:"all"},{id:8,name:"Fantasy",title:"Fantasy",titleKey:"Fantasy",type:"movie"},{id:22,name:"Storia",title:"Historical",titleKey:"Historical",type:"movie"},{id:7,name:"Horror",title:"Horror",titleKey:"Horror",type:"movie"},{id:25,name:"Kids",title:"Kids",titleKey:"Kids",type:"tv"},{id:26,name:"Korean drama",title:"Korean Drama",titleKey:"Korean Drama",type:"all"},{id:14,name:"Musica",title:"Music",titleKey:"Music",type:"movie"},{id:6,name:"Mistero",title:"Mystery",titleKey:"Mystery",type:"all"},{id:37,name:"News",title:"News",titleKey:"News",type:"all"},{id:18,name:"Reality",title:"Reality",titleKey:"Reality",type:"tv"},{id:15,name:"Romance",title:"Romance",titleKey:"Romance",type:"all"},{id:3,name:"Sci-Fi & Fantasy",title:"Sci-Fi & Fantasy",titleKey:"Sci-Fi & Fantasy",type:"tv"},{id:10,name:"Fantascienza",title:"Science Fiction",titleKey:"Science Fiction",type:"movie"},{id:23,name:"Soap",title:"Soap",titleKey:"Soap",type:"tv"},{id:5,name:"Thriller",title:"Thriller",titleKey:"Thriller",type:"movie"},{id:21,name:"televisione film",title:"TV Movie",titleKey:"TV Movie",type:"movie"},{id:9,name:"Guerra",title:"War",titleKey:"War",type:"movie"},{id:17,name:"War & Politics",title:"War & Politics",titleKey:"War & Politics",type:"tv"},{id:20,name:"Western",title:"Western",titleKey:"Western",type:"all"}],exports2.ARCHIVE_YEAR_MIN=1910;exports2.buildArchiveYears=()=>{const maxYear=(new Date).getFullYear(),options=[],seen=new Set;for(let year=maxYear;year>exports2.ARCHIVE_YEAR_MIN;year-=1){const value=year>2e3?year:10*Math.floor(year/10);seen.has(value)||(seen.add(value),options.push({title:String(value),value:value}))}return options},exports2.ARCHIVE_YEAR_OPTIONS=(0,exports2.buildArchiveYears)();var DIACRITICS_REGEX=/[\u0300-\u036f]/g,normalizeKey=value=>value?value.trim().toLowerCase().normalize("NFD").replace(DIACRITICS_REGEX,"").replace(/[^a-z0-9]+/g,""):"",ARCHIVE_SORT_MAP={releasedate:"release_date",release:"release_date",released:"release_date",datauscita:"release_date",lastairdate:"last_air_date",lastair:"last_air_date",dataaggiornamento:"last_air_date",dateadded:"created_at",created:"created_at",createdat:"created_at",dataaggiunta:"created_at",score:"score",rating:"score",valutazione:"score",views:"views",visualizzazioni:"views",name:"name",nome:"name"},ARCHIVE_TYPE_MAP={tv:"tv",serie:"tv",series:"tv",show:"tv",tvshow:"tv",tvshows:"tv",tvseries:"tv",movie:"movie",movies:"movie",film:"movie",films:"movie"},GENRE_ID_SET=new Set(exports2.ARCHIVE_GENRES.map(genre=>genre.id)),GENRE_ID_BY_KEY=exports2.ARCHIVE_GENRES.reduce((acc,genre)=>(acc[normalizeKey(genre.name)]=genre.id,acc[normalizeKey(genre.title)]=genre.id,acc),{}),ARCHIVE_SERVICE_MAP={netflix:"netflix",prime:"prime",primevideo:"prime",amazon:"prime",disney:"disney",disneyplus:"disney",appletv:"apple",appletvplus:"apple",apple:"apple",now:"now",nowtv:"now",hbo:"hbo",hbomax:"hbo",hbomaxplus:"hbo"},ARCHIVE_QUALITY_MAP={hd:"HD",sd:"SD",ts:"TS",cam:"CAM"},ALLOWED_SORT=new Set(exports2.ARCHIVE_SORT_OPTIONS.map(option=>option.value)),ALLOWED_VIEWS=new Set(exports2.ARCHIVE_VIEWS_OPTIONS.map(option=>option.value)),ALLOWED_SCORE=new Set(exports2.ARCHIVE_SCORE_OPTIONS.map(option=>option.value)),ALLOWED_AGE=new Set(exports2.ARCHIVE_AGE_OPTIONS.map(option=>option.value)),ALLOWED_YEAR=new Set(exports2.ARCHIVE_YEAR_OPTIONS.map(option=>option.value));exports2.normalizeArchiveSort=value=>{if(!value)return;const trimmed=value.trim();if(ALLOWED_SORT.has(trimmed))return trimmed;const mapped=((value,mapping)=>{if(!value)return;const normalized=normalizeKey(value);return normalized?mapping[normalized]||value.trim():void 0})(trimmed,ARCHIVE_SORT_MAP);return mapped&&ALLOWED_SORT.has(mapped)?mapped:void 0};exports2.normalizeArchiveType=value=>{if(!value)return;const trimmed=value.trim();if("tv"===trimmed||"movie"===trimmed)return trimmed;const normalized=normalizeKey(trimmed);return ARCHIVE_TYPE_MAP[normalized]};exports2.normalizeArchiveGenre=value=>{if(!value)return;const trimmed=value.trim();if(!trimmed)return;const parsed=Number.parseInt(trimmed,10);if(Number.isFinite(parsed)&&GENRE_ID_SET.has(parsed))return String(parsed);const normalized=normalizeKey(trimmed),resolved=GENRE_ID_BY_KEY[normalized];return resolved?String(resolved):void 0};exports2.normalizeArchiveYear=value=>{if(!value)return;const parsed=Number.parseInt(value.trim(),10);return Number.isFinite(parsed)&&ALLOWED_YEAR.has(parsed)?String(parsed):void 0};exports2.normalizeArchiveScore=value=>{if(!value)return;const parsed=Number.parseInt(value.trim(),10);return Number.isFinite(parsed)&&ALLOWED_SCORE.has(parsed)?String(parsed):void 0};exports2.normalizeArchiveViews=value=>{if(!value)return;const trimmed=value.trim().toLowerCase();if(!trimmed)return;const numeric=trimmed.replace(/[^0-9km]/g,"");let parsed=Number.parseInt(numeric,10);return!Number.isFinite(parsed)||(numeric.includes("m")&&(parsed*=1e6),numeric.includes("k")&&(parsed*=1e3),!Number.isFinite(parsed)||parsed<=0)?void 0:(ALLOWED_VIEWS.has(parsed),String(parsed))};exports2.normalizeArchiveService=value=>{if(!value)return;const trimmed=value.trim();if(!trimmed)return;const normalized=normalizeKey(trimmed);return ARCHIVE_SERVICE_MAP[normalized]||trimmed};exports2.normalizeArchiveQuality=value=>{if(!value)return;const trimmed=value.trim();if(!trimmed)return;if("HD"===trimmed||"SD"===trimmed||"TS"===trimmed||"CAM"===trimmed)return trimmed;const normalized=normalizeKey(trimmed);return ARCHIVE_QUALITY_MAP[normalized]};exports2.normalizeArchiveAge=value=>{if(!value)return;const parsed=Number.parseInt(value.trim(),10);return Number.isFinite(parsed)&&ALLOWED_AGE.has(parsed)?String(parsed):void 0}}}),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSearchPosts=exports.getPosts=void 0;var utils_1=require_utils(),filters_1=require_filters(),DEFAULT_CDN_URL="https://cdn.streamingunity.tv",PAGE_SIZE=60,buildOffset=page=>Math.max(0,(Math.max(1,page)-1)*PAGE_SIZE),parseFilter=filter=>{const trimmed=(filter||"").trim(),[pathPart,queryPart]=trimmed.split("?",2);return{path:(pathPart||"").replace(/^\/+/,"").replace(/\/+$/,"").toLowerCase(),params:new URLSearchParams(queryPart||"")}},splitMultiValues=value=>value.split(/[,|]/).map(item=>item.trim()).filter(Boolean),collectParamValues=(params,keys)=>{if(!keys.length)return[];const targets=keys.map(key=>key.toLowerCase()),values=[];return params.forEach((value,key)=>{const normalizedKey=key.toLowerCase();(targets.includes(normalizedKey)||targets.some(target=>normalizedKey.startsWith(`${target}[`)))&&values.push(value)}),values.filter(Boolean)},normalizeArchiveFilters=params=>{const search=params.get("search")||params.get("q")||params.get("query")||params.get("title")||"",sort=(0,filters_1.normalizeArchiveSort)(params.get("sort")||params.get("sort_by")||params.get("order")),type=(0,filters_1.normalizeArchiveType)(params.get("type")||params.get("category")),genres=new Set;collectParamValues(params,["genre","genres"]).forEach(raw=>{splitMultiValues(raw).forEach(value=>{const normalized=(0,filters_1.normalizeArchiveGenre)(value);normalized&&genres.add(normalized)})});const year=(0,filters_1.normalizeArchiveYear)(params.get("year")||params.get("years")),score=(0,filters_1.normalizeArchiveScore)(params.get("score")||params.get("rating")),views=(0,filters_1.normalizeArchiveViews)(params.get("views")),service=(0,filters_1.normalizeArchiveService)(params.get("service")),quality=(0,filters_1.normalizeArchiveQuality)(params.get("quality")),age=(0,filters_1.normalizeArchiveAge)(params.get("age")||params.get("age_min")||params.get("rating_age"));return{search:search.trim()||void 0,sort:sort,type:"tv"===type||"movie"===type?type:void 0,genres:genres.size>0?Array.from(genres):void 0,year:year,score:score,views:views,service:service,quality:quality,age:age}},HOME_SLIDER_KEYS=new Set(["trending","latest","top10"]),resolveSliderKey=path=>{if(!path)return null;const normalized=path.toLowerCase();if(normalized.startsWith("browse/")){const key=normalized.replace(/^browse\//,"");return HOME_SLIDER_KEYS.has(key)?key:null}return HOME_SLIDER_KEYS.has(normalized)?normalized:null},findSlider=(sliders,key)=>{if(!Array.isArray(sliders)||!key)return null;const normalizedKey=key.toLowerCase(),byName=sliders.find(slider=>String((null==slider?void 0:slider.name)||"").toLowerCase()===normalizedKey);if(byName)return byName;const labelHints={trending:["titoli del momento","trending"],latest:["aggiunti di recente","recently"],top10:["top 10"]}[normalizedKey]||[];return sliders.find(slider=>{const label=(0,utils_1.normalizeText)(String((null==slider?void 0:slider.label)||"")).toLowerCase();return labelHints.some(hint=>label.includes(hint))})||null},mapTitleToPost=(title,baseUrl,cdnUrl)=>{if(!(null==title?void 0:title.id))return null;const slug=(0,utils_1.resolveTitleSlug)(title,utils_1.DEFAULT_LOCALE),link=(0,utils_1.buildTitleUrl)(title.id,slug,baseUrl),name=(0,utils_1.resolveTitleName)(title,utils_1.DEFAULT_LOCALE),image=(0,utils_1.pickImageByType)(null==title?void 0:title.images,cdnUrl,["poster","cover","background"]);return name&&link&&image?{title:name,link:link,image:image}:null},mapTitlesToPosts=(titles,baseUrl,cdnUrl,type)=>{if(!Array.isArray(titles))return[];const posts=[],seen=new Set;return titles.forEach(title=>{if(type&&String((null==title?void 0:title.type)||"").toLowerCase()!==type)return;const post=mapTitleToPost(title,baseUrl,cdnUrl);post&&post.link&&!seen.has(post.link)&&(posts.push(post),seen.add(post.link))}),posts},fetchHtml=(url,providerContext,signal)=>__awaiter(void 0,void 0,void 0,function*(){var _a;const{axios:axios,commonHeaders:commonHeaders}=providerContext,res=yield axios.get(url,{headers:Object.assign(Object.assign({},commonHeaders),{Referer:url}),timeout:utils_1.REQUEST_TIMEOUT,signal:signal});return"string"==typeof res.data?res.data:String(null!==(_a=res.data)&&void 0!==_a?_a:"")}),fetchHomePosts=_a=>__awaiter(void 0,[_a],void 0,function*({baseUrl:baseUrl,sliderKey:sliderKey,type:type,providerContext:providerContext,signal:signal,page:page}){var _b,_c,_d;const offset=buildOffset(page);let cdnUrl=DEFAULT_CDN_URL;if(page<=1){const homeUrl=(0,utils_1.buildLocaleUrl)("/",baseUrl),html=yield fetchHtml(homeUrl,providerContext,signal),pageData=(0,utils_1.extractInertiaPage)(html,providerContext.cheerio);cdnUrl=(null===(_b=null==pageData?void 0:pageData.props)||void 0===_b?void 0:_b.cdn_url)||DEFAULT_CDN_URL;const sliders=(null===(_c=null==pageData?void 0:pageData.props)||void 0===_c?void 0:_c.sliders)||[],slider=findSlider(sliders,sliderKey),titles=(null==slider?void 0:slider.titles)||[],posts=mapTitlesToPosts(titles,baseUrl,cdnUrl,type);if(posts.length>0)return posts}try{const params=new URLSearchParams;offset>0&&params.set("offset",String(offset));const apiUrl=`${baseUrl.replace(/\/+$/,"")}/api/browse/${sliderKey}${params.toString()?`?${params.toString()}`:""}`,res=yield providerContext.axios.get(apiUrl,{headers:providerContext.commonHeaders,timeout:utils_1.REQUEST_TIMEOUT,signal:signal}),apiTitles=(null===(_d=null==res?void 0:res.data)||void 0===_d?void 0:_d.titles)||[];return mapTitlesToPosts(apiTitles,baseUrl,cdnUrl,type)}catch(err){return[]}}),fetchArchivePosts=_a=>__awaiter(void 0,[_a],void 0,function*({baseUrl:baseUrl,filters:filters,providerContext:providerContext,signal:signal,page:page}){var _b,_c,_d;const offset=buildOffset(page);let cdnUrl=DEFAULT_CDN_URL;const archiveFilters=filters||{},buildArchiveParams=includeOffset=>{const params=new URLSearchParams;return archiveFilters.search&&params.set("search",archiveFilters.search),archiveFilters.sort&&params.set("sort",archiveFilters.sort),archiveFilters.type&&params.set("type",archiveFilters.type),archiveFilters.year&&params.set("year",archiveFilters.year),archiveFilters.score&&params.set("score",archiveFilters.score),archiveFilters.views&&params.set("views",archiveFilters.views),archiveFilters.service&&params.set("service",archiveFilters.service),archiveFilters.quality&&params.set("quality",archiveFilters.quality),archiveFilters.age&&params.set("age",archiveFilters.age),archiveFilters.genres&&archiveFilters.genres.length>0&&archiveFilters.genres.forEach(genre=>{genre&&params.append("genre[]",genre)}),includeOffset&&offset>0&&params.set("offset",String(offset)),params};if(page<=1){const query=buildArchiveParams(!1).toString(),archiveUrl=(0,utils_1.buildLocaleUrl)("/archive"+(query?`?${query}`:""),baseUrl),html=yield fetchHtml(archiveUrl,providerContext,signal),pageData=(0,utils_1.extractInertiaPage)(html,providerContext.cheerio);cdnUrl=(null===(_b=null==pageData?void 0:pageData.props)||void 0===_b?void 0:_b.cdn_url)||DEFAULT_CDN_URL;const titles=(null===(_c=null==pageData?void 0:pageData.props)||void 0===_c?void 0:_c.titles)||[],posts=mapTitlesToPosts(titles,baseUrl,cdnUrl,archiveFilters.type);if(posts.length>0)return posts}try{const params=buildArchiveParams(!0),apiUrl=`${baseUrl.replace(/\/+$/,"")}/api/archive${params.toString()?`?${params.toString()}`:""}`,res=yield providerContext.axios.get(apiUrl,{headers:providerContext.commonHeaders,timeout:utils_1.REQUEST_TIMEOUT,signal:signal}),apiTitles=(null===(_d=null==res?void 0:res.data)||void 0===_d?void 0:_d.titles)||[];return mapTitlesToPosts(apiTitles,baseUrl,cdnUrl,archiveFilters.type)}catch(err){return[]}}),getPosts=function(_a){return __awaiter(this,arguments,void 0,function*({filter:filter,page:page,signal:signal,providerContext:providerContext}){try{if(null==signal?void 0:signal.aborted)return[];const baseUrl=yield(0,utils_1.resolveBaseUrl)(providerContext),parsed=parseFilter(filter),archiveFilters=normalizeArchiveFilters(parsed.params),sliderKey=resolveSliderKey(parsed.path);return sliderKey?yield fetchHomePosts({baseUrl:baseUrl,sliderKey:sliderKey,type:archiveFilters.type,providerContext:providerContext,signal:signal,page:page}):(parsed.path.startsWith("archive"),yield fetchArchivePosts({baseUrl:baseUrl,filters:archiveFilters,providerContext:providerContext,signal:signal,page:page}))}catch(err){return[]}})};exports.getPosts=getPosts;var getSearchPosts=function(_a){return __awaiter(this,arguments,void 0,function*({searchQuery:searchQuery,page:page,signal:signal,providerContext:providerContext}){var _b,_c;try{if(null==signal?void 0:signal.aborted)return[];const query=(searchQuery||"").trim();if(!query)return[];const baseUrl=yield(0,utils_1.resolveBaseUrl)(providerContext),offset=buildOffset(page),fetchSearchApi=cdnUrl=>__awaiter(this,void 0,void 0,function*(){var _a2,_b2;const params=new URLSearchParams;params.set("q",query),offset>0&&params.set("offset",String(offset));const apiUrl=`${baseUrl.replace(/\/+$/,"")}/api/search?${params.toString()}`,res=yield providerContext.axios.get(apiUrl,{headers:providerContext.commonHeaders,timeout:utils_1.REQUEST_TIMEOUT,signal:signal}),apiTitles=(null===(_a2=null==res?void 0:res.data)||void 0===_a2?void 0:_a2.data)||(null===(_b2=null==res?void 0:res.data)||void 0===_b2?void 0:_b2.titles)||[];return mapTitlesToPosts(apiTitles,baseUrl,cdnUrl)});if(page<=1){const searchUrl=(0,utils_1.buildLocaleUrl)(`/search?q=${encodeURIComponent(query)}`,baseUrl),html=yield fetchHtml(searchUrl,providerContext,signal),pageData=(0,utils_1.extractInertiaPage)(html,providerContext.cheerio),cdnUrl=(null===(_b=null==pageData?void 0:pageData.props)||void 0===_b?void 0:_b.cdn_url)||DEFAULT_CDN_URL,titles=(null===(_c=null==pageData?void 0:pageData.props)||void 0===_c?void 0:_c.titles)||[],posts=mapTitlesToPosts(titles,baseUrl,cdnUrl);return posts.length>0?posts:yield fetchSearchApi(cdnUrl)}try{return yield fetchSearchApi(DEFAULT_CDN_URL)}catch(err){return[]}}catch(err){return[]}})};exports.getSearchPosts=getSearchPosts;
var module={exports:exports},__getOwnPropNames=Object.getOwnPropertyNames,__commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports},require_utils=__commonJS({"dist/streamingunity/utils.js"(exports2){"use strict";var __awaiter2=exports2&&exports2.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports2,"__esModule",{value:!0}),exports2.normalizeText=exports2.buildTitleUrl=exports2.extractTitleId=exports2.pickImageByType=exports2.buildImageUrl=exports2.resolveTitleSlug=exports2.resolveTitleName=exports2.getTranslationValue=exports2.extractInertiaPage=exports2.decodeHtmlEntities=exports2.buildLocaleUrl=exports2.resolveUrl=exports2.buildLocalePath=exports2.resolveBaseUrl=exports2.normalizeBaseUrl=exports2.REQUEST_TIMEOUT=exports2.DEFAULT_LOCALE=exports2.DEFAULT_BASE_URL=void 0,exports2.DEFAULT_BASE_URL="https://streamingunity.tv",exports2.DEFAULT_LOCALE="it",exports2.REQUEST_TIMEOUT=15e3;exports2.normalizeBaseUrl=value=>value.replace(/\/+$/,"");exports2.resolveBaseUrl=providerContext=>__awaiter2(void 0,void 0,void 0,function*(){try{const resolved=yield providerContext.getBaseUrl("streamingunity");if(resolved)return(0,exports2.normalizeBaseUrl)(resolved)}catch(_){}return exports2.DEFAULT_BASE_URL});exports2.buildLocalePath=path=>{const normalized=path?(value=path.trim()).startsWith("/")?value:`/${value}`:"";var value;return normalized&&"/"!==normalized?normalized.startsWith(`/${exports2.DEFAULT_LOCALE}/`)||normalized===`/${exports2.DEFAULT_LOCALE}`?normalized:`/${exports2.DEFAULT_LOCALE}${normalized}`:`/${exports2.DEFAULT_LOCALE}`};exports2.resolveUrl=(href,baseUrl)=>href?/^https?:\/\//i.test(href)?href:new URL(href,baseUrl).href:"";exports2.buildLocaleUrl=(path,baseUrl)=>(0,exports2.resolveUrl)((0,exports2.buildLocalePath)(path),baseUrl);exports2.decodeHtmlEntities=value=>value.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");exports2.extractInertiaPage=(html,cheerio)=>{if(!html)return null;const $=cheerio.load(html),raw=$("#app[data-page]").first().attr("data-page")||$("div[data-page]").first().attr("data-page")||"";if(!raw)return null;const decoded=(0,exports2.decodeHtmlEntities)(raw);try{return JSON.parse(decoded)}catch(_){try{return JSON.parse((0,exports2.decodeHtmlEntities)(decoded))}catch(err){return null}}};exports2.getTranslationValue=(translations,key,locale=exports2.DEFAULT_LOCALE)=>{if(!Array.isArray(translations))return"";const match=translations.find(item=>item&&item.key===key&&item.locale===locale);return(null==match?void 0:match.value)?String(match.value).trim():""};exports2.resolveTitleName=(title,locale=exports2.DEFAULT_LOCALE)=>{const translations=null==title?void 0:title.translations,translated=(0,exports2.getTranslationValue)(translations,"name",locale);if(translated)return translated;if("en"!==locale){const english=(0,exports2.getTranslationValue)(translations,"name","en");if(english)return english}const normalizedSlug=(value=>{const raw=String(value||"").trim();if(!raw)return"";const normalized=raw.replace(/[-_]+/g," ").replace(/\s+/g," ").trim();return normalized?normalized.split(" ").map(word=>word?word[0].toUpperCase()+word.slice(1):"").join(" "):""})((0,exports2.getTranslationValue)(translations,"slug",locale)||(0,exports2.getTranslationValue)(translations,"slug","en")||String((null==title?void 0:title.slug)||"").trim());if(normalizedSlug)return normalizedSlug;const fallback=(null==title?void 0:title.name)||(null==title?void 0:title.original_name)||"";return String(fallback||"").trim()};exports2.resolveTitleSlug=(title,locale=exports2.DEFAULT_LOCALE)=>(0,exports2.getTranslationValue)(null==title?void 0:title.translations,"slug",locale)||String((null==title?void 0:title.slug)||"").trim();exports2.buildImageUrl=(image,cdnUrl)=>{if(!image)return"";const raw=image.original_url_field||image.url||image.src||image.path||image.filename||"";if(!raw)return"";if(/^https?:\/\//i.test(raw))return raw;const normalizedCdn=cdnUrl?cdnUrl.replace(/\/+$/,""):"";return normalizedCdn?`${normalizedCdn}/images/${String(raw).replace(/^\/+/,"")}`:raw};exports2.pickImageByType=(images,cdnUrl,types,locale=exports2.DEFAULT_LOCALE)=>{if(!Array.isArray(images)||0===images.length)return"";const normalizedTypes=types.map(type=>type.toLowerCase());for(const type of normalizedTypes){const matches=images.filter(img=>String((null==img?void 0:img.type)||"").toLowerCase()===type);if(0===matches.length)continue;const fallback2=matches.find(img=>String((null==img?void 0:img.lang)||"").toLowerCase()===locale)||matches.find(img=>!(null==img?void 0:img.lang))||matches[0],url=(0,exports2.buildImageUrl)(fallback2,cdnUrl);if(url)return url}const fallback=images[0];return(0,exports2.buildImageUrl)(fallback,cdnUrl)};exports2.extractTitleId=value=>{if(!value)return"";const cleaned=value.split("::")[0],match=cleaned.match(/\/(?:titles|watch)\/(\d+)/i)||cleaned.match(/^(\d+)$/);return(null==match?void 0:match[1])||""};exports2.buildTitleUrl=(titleId,slug,baseUrl)=>{const id=String(titleId||"").trim();if(!id)return"";const safeSlug=slug?`-${slug}`:"";return(0,exports2.buildLocaleUrl)(`/titles/${id}${safeSlug}`,baseUrl)};exports2.normalizeText=value=>String(value||"").replace(/\s+/g," ").trim()}}),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSearchPosts=exports.getPosts=void 0;var utils_1=require_utils(),DEFAULT_CDN_URL="https://cdn.streamingunity.tv",PAGE_SIZE=60,buildOffset=page=>Math.max(0,(Math.max(1,page)-1)*PAGE_SIZE),normalizeType=value=>{if(!value)return;const normalized=value.toLowerCase();return["tv","series","show","serie","serietv","tvshow"].includes(normalized)?"tv":["movie","movies","film","films"].includes(normalized)?"movie":void 0},parseFilter=filter=>{const trimmed=(filter||"").trim(),[pathPart,queryPart]=trimmed.split("?",2);return{path:(pathPart||"").replace(/^\/+/,"").replace(/\/+$/,"").toLowerCase(),params:new URLSearchParams(queryPart||"")}},HOME_SLIDER_KEYS=new Set(["trending","latest","top10"]),resolveSliderKey=path=>{if(!path)return null;const normalized=path.toLowerCase();if(normalized.startsWith("browse/")){const key=normalized.replace(/^browse\//,"");return HOME_SLIDER_KEYS.has(key)?key:null}return HOME_SLIDER_KEYS.has(normalized)?normalized:null},findSlider=(sliders,key)=>{if(!Array.isArray(sliders)||!key)return null;const normalizedKey=key.toLowerCase(),byName=sliders.find(slider=>String((null==slider?void 0:slider.name)||"").toLowerCase()===normalizedKey);if(byName)return byName;const labelHints={trending:["titoli del momento","trending"],latest:["aggiunti di recente","recently"],top10:["top 10"]}[normalizedKey]||[];return sliders.find(slider=>{const label=(0,utils_1.normalizeText)(String((null==slider?void 0:slider.label)||"")).toLowerCase();return labelHints.some(hint=>label.includes(hint))})||null},mapTitleToPost=(title,baseUrl,cdnUrl)=>{if(!(null==title?void 0:title.id))return null;const slug=(0,utils_1.resolveTitleSlug)(title,utils_1.DEFAULT_LOCALE),link=(0,utils_1.buildTitleUrl)(title.id,slug,baseUrl),name=(0,utils_1.resolveTitleName)(title,utils_1.DEFAULT_LOCALE),image=(0,utils_1.pickImageByType)(null==title?void 0:title.images,cdnUrl,["poster","cover","background"]);return name&&link&&image?{title:name,link:link,image:image}:null},mapTitlesToPosts=(titles,baseUrl,cdnUrl,type)=>{if(!Array.isArray(titles))return[];const posts=[],seen=new Set;return titles.forEach(title=>{if(type&&String((null==title?void 0:title.type)||"").toLowerCase()!==type)return;const post=mapTitleToPost(title,baseUrl,cdnUrl);post&&post.link&&!seen.has(post.link)&&(posts.push(post),seen.add(post.link))}),posts},fetchHtml=(url,providerContext,signal)=>__awaiter(void 0,void 0,void 0,function*(){var _a;const{axios:axios,commonHeaders:commonHeaders}=providerContext,res=yield axios.get(url,{headers:Object.assign(Object.assign({},commonHeaders),{Referer:url}),timeout:utils_1.REQUEST_TIMEOUT,signal:signal});return"string"==typeof res.data?res.data:String(null!==(_a=res.data)&&void 0!==_a?_a:"")}),fetchHomePosts=_a=>__awaiter(void 0,[_a],void 0,function*({baseUrl:baseUrl,sliderKey:sliderKey,type:type,providerContext:providerContext,signal:signal,page:page}){var _b,_c,_d;const offset=buildOffset(page);let cdnUrl=DEFAULT_CDN_URL;if(page<=1){const homeUrl=(0,utils_1.buildLocaleUrl)("/",baseUrl),html=yield fetchHtml(homeUrl,providerContext,signal),pageData=(0,utils_1.extractInertiaPage)(html,providerContext.cheerio);cdnUrl=(null===(_b=null==pageData?void 0:pageData.props)||void 0===_b?void 0:_b.cdn_url)||DEFAULT_CDN_URL;const sliders=(null===(_c=null==pageData?void 0:pageData.props)||void 0===_c?void 0:_c.sliders)||[],slider=findSlider(sliders,sliderKey),titles=(null==slider?void 0:slider.titles)||[],posts=mapTitlesToPosts(titles,baseUrl,cdnUrl,type);if(posts.length>0)return posts}try{const params=new URLSearchParams;offset>0&&params.set("offset",String(offset));const apiUrl=`${baseUrl.replace(/\/+$/,"")}/api/browse/${sliderKey}${params.toString()?`?${params.toString()}`:""}`,res=yield providerContext.axios.get(apiUrl,{headers:providerContext.commonHeaders,timeout:utils_1.REQUEST_TIMEOUT,signal:signal}),apiTitles=(null===(_d=null==res?void 0:res.data)||void 0===_d?void 0:_d.titles)||[];return mapTitlesToPosts(apiTitles,baseUrl,cdnUrl,type)}catch(err){return[]}}),fetchArchivePosts=_a=>__awaiter(void 0,[_a],void 0,function*({baseUrl:baseUrl,type:type,providerContext:providerContext,signal:signal,page:page}){var _b,_c,_d;const offset=buildOffset(page);let cdnUrl=DEFAULT_CDN_URL;if(page<=1){const query=type?`?type=${encodeURIComponent(type)}`:"",archiveUrl=(0,utils_1.buildLocaleUrl)(`/archive${query}`,baseUrl),html=yield fetchHtml(archiveUrl,providerContext,signal),pageData=(0,utils_1.extractInertiaPage)(html,providerContext.cheerio);cdnUrl=(null===(_b=null==pageData?void 0:pageData.props)||void 0===_b?void 0:_b.cdn_url)||DEFAULT_CDN_URL;const titles=(null===(_c=null==pageData?void 0:pageData.props)||void 0===_c?void 0:_c.titles)||[],posts=mapTitlesToPosts(titles,baseUrl,cdnUrl,type);if(posts.length>0)return posts}try{const params=new URLSearchParams;type&&params.set("type",type),offset>0&&params.set("offset",String(offset));const apiUrl=`${baseUrl.replace(/\/+$/,"")}/api/archive${params.toString()?`?${params.toString()}`:""}`,res=yield providerContext.axios.get(apiUrl,{headers:providerContext.commonHeaders,timeout:utils_1.REQUEST_TIMEOUT,signal:signal}),apiTitles=(null===(_d=null==res?void 0:res.data)||void 0===_d?void 0:_d.titles)||[];return mapTitlesToPosts(apiTitles,baseUrl,cdnUrl,type)}catch(err){return[]}}),getPosts=function(_a){return __awaiter(this,arguments,void 0,function*({filter:filter,page:page,signal:signal,providerContext:providerContext}){try{if(null==signal?void 0:signal.aborted)return[];const baseUrl=yield(0,utils_1.resolveBaseUrl)(providerContext),parsed=parseFilter(filter),type=normalizeType(parsed.params.get("type")),sliderKey=resolveSliderKey(parsed.path);return sliderKey?yield fetchHomePosts({baseUrl:baseUrl,sliderKey:sliderKey,type:type,providerContext:providerContext,signal:signal,page:page}):(parsed.path.startsWith("archive"),yield fetchArchivePosts({baseUrl:baseUrl,type:type,providerContext:providerContext,signal:signal,page:page}))}catch(err){return[]}})};exports.getPosts=getPosts;var getSearchPosts=function(_a){return __awaiter(this,arguments,void 0,function*({searchQuery:searchQuery,page:page,signal:signal,providerContext:providerContext}){var _b,_c;try{if(null==signal?void 0:signal.aborted)return[];const query=(searchQuery||"").trim();if(!query)return[];const baseUrl=yield(0,utils_1.resolveBaseUrl)(providerContext),offset=buildOffset(page),fetchSearchApi=cdnUrl=>__awaiter(this,void 0,void 0,function*(){var _a2,_b2;const params=new URLSearchParams;params.set("q",query),offset>0&&params.set("offset",String(offset));const apiUrl=`${baseUrl.replace(/\/+$/,"")}/api/search?${params.toString()}`,res=yield providerContext.axios.get(apiUrl,{headers:providerContext.commonHeaders,timeout:utils_1.REQUEST_TIMEOUT,signal:signal}),apiTitles=(null===(_a2=null==res?void 0:res.data)||void 0===_a2?void 0:_a2.data)||(null===(_b2=null==res?void 0:res.data)||void 0===_b2?void 0:_b2.titles)||[];return mapTitlesToPosts(apiTitles,baseUrl,cdnUrl)});if(page<=1){const searchUrl=(0,utils_1.buildLocaleUrl)(`/search?q=${encodeURIComponent(query)}`,baseUrl),html=yield fetchHtml(searchUrl,providerContext,signal),pageData=(0,utils_1.extractInertiaPage)(html,providerContext.cheerio),cdnUrl=(null===(_b=null==pageData?void 0:pageData.props)||void 0===_b?void 0:_b.cdn_url)||DEFAULT_CDN_URL,titles=(null===(_c=null==pageData?void 0:pageData.props)||void 0===_c?void 0:_c.titles)||[],posts=mapTitlesToPosts(titles,baseUrl,cdnUrl);return posts.length>0?posts:yield fetchSearchApi(cdnUrl)}try{return yield fetchSearchApi(DEFAULT_CDN_URL)}catch(err){return[]}}catch(err){return[]}})};exports.getSearchPosts=getSearchPosts;
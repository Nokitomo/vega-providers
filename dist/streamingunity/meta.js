var module={exports:exports},__getOwnPropNames=Object.getOwnPropertyNames,__commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports},require_utils=__commonJS({"dist/streamingunity/utils.js"(exports2){"use strict";var __awaiter2=exports2&&exports2.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports2,"__esModule",{value:!0}),exports2.normalizeText=exports2.buildTitleUrl=exports2.extractTitleId=exports2.pickImageByType=exports2.buildImageUrl=exports2.resolveTitleSlug=exports2.resolveTitleName=exports2.getTranslationValue=exports2.extractInertiaPage=exports2.decodeHtmlEntities=exports2.buildLocaleUrl=exports2.resolveUrl=exports2.buildLocalePath=exports2.resolveBaseUrl=exports2.normalizeBaseUrl=exports2.REQUEST_TIMEOUT=exports2.DEFAULT_LOCALE=exports2.DEFAULT_BASE_URL=void 0,exports2.DEFAULT_BASE_URL="https://streamingunity.tv",exports2.DEFAULT_LOCALE="it",exports2.REQUEST_TIMEOUT=15e3;exports2.normalizeBaseUrl=value=>value.replace(/\/+$/,"");exports2.resolveBaseUrl=providerContext=>__awaiter2(void 0,void 0,void 0,function*(){try{const resolved=yield providerContext.getBaseUrl("streamingunity");if(resolved)return(0,exports2.normalizeBaseUrl)(resolved)}catch(_){}return exports2.DEFAULT_BASE_URL});exports2.buildLocalePath=path=>{const normalized=path?(value=path.trim()).startsWith("/")?value:`/${value}`:"";var value;return normalized&&"/"!==normalized?normalized.startsWith(`/${exports2.DEFAULT_LOCALE}/`)||normalized===`/${exports2.DEFAULT_LOCALE}`?normalized:`/${exports2.DEFAULT_LOCALE}${normalized}`:`/${exports2.DEFAULT_LOCALE}`};exports2.resolveUrl=(href,baseUrl)=>href?/^https?:\/\//i.test(href)?href:new URL(href,baseUrl).href:"";exports2.buildLocaleUrl=(path,baseUrl)=>(0,exports2.resolveUrl)((0,exports2.buildLocalePath)(path),baseUrl);exports2.decodeHtmlEntities=value=>value.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");exports2.extractInertiaPage=(html,cheerio)=>{if(!html)return null;const $=cheerio.load(html),raw=$("#app[data-page]").first().attr("data-page")||$("div[data-page]").first().attr("data-page")||"";if(!raw)return null;const decoded=(0,exports2.decodeHtmlEntities)(raw);try{return JSON.parse(decoded)}catch(_){try{return JSON.parse((0,exports2.decodeHtmlEntities)(decoded))}catch(err){return null}}};exports2.getTranslationValue=(translations,key,locale=exports2.DEFAULT_LOCALE)=>{if(!Array.isArray(translations))return"";const match=translations.find(item=>item&&item.key===key&&item.locale===locale);return(null==match?void 0:match.value)?String(match.value).trim():""};exports2.resolveTitleName=(title,locale=exports2.DEFAULT_LOCALE)=>{const translations=null==title?void 0:title.translations,translated=(0,exports2.getTranslationValue)(translations,"name",locale);if(translated)return translated;if("en"!==locale){const english=(0,exports2.getTranslationValue)(translations,"name","en");if(english)return english}const normalizedSlug=(value=>{const raw=String(value||"").trim();if(!raw)return"";const normalized=raw.replace(/[-_]+/g," ").replace(/\s+/g," ").trim();return normalized?normalized.split(" ").map(word=>word?word[0].toUpperCase()+word.slice(1):"").join(" "):""})((0,exports2.getTranslationValue)(translations,"slug",locale)||(0,exports2.getTranslationValue)(translations,"slug","en")||String((null==title?void 0:title.slug)||"").trim());if(normalizedSlug)return normalizedSlug;const fallback=(null==title?void 0:title.name)||(null==title?void 0:title.original_name)||"";return String(fallback||"").trim()};exports2.resolveTitleSlug=(title,locale=exports2.DEFAULT_LOCALE)=>(0,exports2.getTranslationValue)(null==title?void 0:title.translations,"slug",locale)||String((null==title?void 0:title.slug)||"").trim();exports2.buildImageUrl=(image,cdnUrl)=>{if(!image)return"";const raw=image.original_url_field||image.url||image.src||image.path||image.filename||"";if(!raw)return"";if(/^https?:\/\//i.test(raw))return raw;const normalizedCdn=cdnUrl?cdnUrl.replace(/\/+$/,""):"";return normalizedCdn?`${normalizedCdn}/images/${String(raw).replace(/^\/+/,"")}`:raw};exports2.pickImageByType=(images,cdnUrl,types,locale=exports2.DEFAULT_LOCALE)=>{if(!Array.isArray(images)||0===images.length)return"";const normalizedTypes=types.map(type=>type.toLowerCase());for(const type of normalizedTypes){const matches=images.filter(img=>String((null==img?void 0:img.type)||"").toLowerCase()===type);if(0===matches.length)continue;const fallback2=matches.find(img=>String((null==img?void 0:img.lang)||"").toLowerCase()===locale)||matches.find(img=>!(null==img?void 0:img.lang))||matches[0],url=(0,exports2.buildImageUrl)(fallback2,cdnUrl);if(url)return url}const fallback=images[0];return(0,exports2.buildImageUrl)(fallback,cdnUrl)};exports2.extractTitleId=value=>{if(!value)return"";const cleaned=value.split("::")[0],match=cleaned.match(/\/(?:titles|watch)\/(\d+)/i)||cleaned.match(/^(\d+)$/);return(null==match?void 0:match[1])||""};exports2.buildTitleUrl=(titleId,slug,baseUrl)=>{const id=String(titleId||"").trim();if(!id)return"";const safeSlug=slug?`-${slug}`:"";return(0,exports2.buildLocaleUrl)(`/titles/${id}${safeSlug}`,baseUrl)};exports2.normalizeText=value=>String(value||"").replace(/\s+/g," ").trim()}}),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;var utils_1=require_utils(),DEFAULT_CDN_URL="https://cdn.streamingunity.tv",extractYear=value=>{if(!value)return;const match=String(value).match(/\d{4}/);return match?match[0]:void 0},normalizeRuntime=value=>{if(null==value)return;const raw="number"==typeof value?value:Number.parseInt(String(value),10);if(Number.isFinite(raw)){const total=Math.max(0,Math.floor(raw)),hours=Math.floor(total/60),minutes=total%60;return hours>0&&minutes>0?`${hours}h ${minutes}m`:hours>0?`${hours}h`:`${minutes}m`}return String(value).trim()||void 0},toNumber=value=>{if(null==value||""===value)return;const parsed=Number(value);return Number.isFinite(parsed)?parsed:void 0},extractSlugFromLink=link=>{if(!link)return"";const match=link.match(/\/titles\/\d+-([^/?#]+)/i);return(null==match?void 0:match[1])?String(match[1]).trim():""},normalizePeople=items=>Array.isArray(items)?items.map(item=>item?"string"==typeof item?item.trim():String((null==item?void 0:item.name)||(null==item?void 0:item.title)||"").trim():"").filter(Boolean):[],normalizeGenreName=genre=>(0,utils_1.getTranslationValue)(null==genre?void 0:genre.translations,"name",utils_1.DEFAULT_LOCALE)||String((null==genre?void 0:genre.name)||"").trim(),normalizeGenres=genres=>Array.isArray(genres)?genres.map(genre=>normalizeGenreName(genre)).filter(Boolean):[],normalizeKeywords=keywords=>Array.isArray(keywords)?keywords.map(keyword=>String((null==keyword?void 0:keyword.name)||"").trim()).filter(Boolean):[],mergeTags=(genres,keywords)=>{const merged=new Set;return genres.forEach(value=>value&&merged.add(value)),keywords.forEach(value=>value&&merged.add(value)),Array.from(merged)},fetchHtml=(url,providerContext,signal)=>__awaiter(void 0,void 0,void 0,function*(){var _a;const{axios:axios,commonHeaders:commonHeaders}=providerContext,res=yield axios.get(url,{headers:Object.assign(Object.assign({},commonHeaders),{Referer:url}),timeout:utils_1.REQUEST_TIMEOUT,signal:signal});return"string"==typeof res.data?res.data:String(null!==(_a=res.data)&&void 0!==_a?_a:"")}),buildTitlePath=(titleId,slug)=>slug?`/titles/${titleId}-${slug}`:`/titles/${titleId}`,buildSeasonUrl=(baseUrl,titleId,slug,seasonNumber)=>{const path=`${buildTitlePath(titleId,slug)}/season-${seasonNumber}`;return(0,utils_1.buildLocaleUrl)(path,baseUrl)},buildEpisodeLinks=(episodes,titleId)=>{if(!Array.isArray(episodes)||0===episodes.length)return{links:[],count:0};const links=episodes.map(episode=>{const number=null!=(null==episode?void 0:episode.number)?String(episode.number):"",translatedName=(0,utils_1.getTranslationValue)(null==episode?void 0:episode.translations,"name",utils_1.DEFAULT_LOCALE),name=(0,utils_1.normalizeText)(translatedName||(null==episode?void 0:episode.name)||""),titleKey=!name&&number?"Episode {{number}}":void 0;return{title:name||(number?`Episode ${number}`:"Episode"),titleKey:titleKey,titleParams:titleKey?{number:number}:void 0,link:`${titleId}::${(null==episode?void 0:episode.id)||""}`,type:"series"}}).filter(link=>link.link&&link.title);return{links:links,count:links.length}},buildSeriesLinks=_a=>__awaiter(void 0,[_a],void 0,function*({title:title,slug:slug,baseUrl:baseUrl,loadedSeason:loadedSeason,providerContext:providerContext,signal:signal}){var _b,_c;const seasons=Array.isArray(null==title?void 0:title.seasons)?title.seasons:[];if(0===seasons.length)return{linkList:[]};const titleId=String(title.id||"").trim(),seasonById=new Map;seasons.forEach(season=>{null!=(null==season?void 0:season.id)&&seasonById.set(String(season.id),season)});const episodesBySeason=new Map;if((null==loadedSeason?void 0:loadedSeason.id)&&Array.isArray(loadedSeason.episodes)){const seasonInfo=seasonById.get(String(loadedSeason.id)),seasonNumber=Number(null==seasonInfo?void 0:seasonInfo.number);Number.isFinite(seasonNumber)&&seasonNumber>0&&episodesBySeason.set(seasonNumber,loadedSeason.episodes)}const sortedSeasons=[...seasons].sort((a,b)=>(Number(null==a?void 0:a.number)||0)-(Number(null==b?void 0:b.number)||0)),linkList=[];let episodesCount=0;for(const season of sortedSeasons){const seasonNumber=Number(null==season?void 0:season.number);if(!Number.isFinite(seasonNumber)||seasonNumber<=0||!titleId)continue;let episodes=episodesBySeason.get(seasonNumber);if(!episodes)try{const seasonUrl=buildSeasonUrl(baseUrl,titleId,slug,seasonNumber),html=yield fetchHtml(seasonUrl,providerContext,signal),page=(0,utils_1.extractInertiaPage)(html,providerContext.cheerio);episodes=(null===(_c=null===(_b=null==page?void 0:page.props)||void 0===_b?void 0:_b.loadedSeason)||void 0===_c?void 0:_c.episodes)||[],Array.isArray(episodes)&&episodesBySeason.set(seasonNumber,episodes)}catch(err){episodes=[]}const built=buildEpisodeLinks(episodes||[],titleId);episodesCount+=built.count,linkList.push({title:`Season ${seasonNumber}`,titleKey:"Season {{number}}",titleParams:{number:seasonNumber},directLinks:built.links})}return{linkList:linkList,episodesCount:episodesCount||void 0}}),buildRelated=(sliders,baseUrl,cdnUrl)=>{if(!Array.isArray(sliders))return;const relatedSlider=sliders.find(slider=>"related"===String((null==slider?void 0:slider.name)||"").toLowerCase()),titles=(null==relatedSlider?void 0:relatedSlider.titles)||[];if(!Array.isArray(titles)||0===titles.length)return;const related=titles.map(item=>{if(!(null==item?void 0:item.id))return null;const slug=(0,utils_1.resolveTitleSlug)(item,utils_1.DEFAULT_LOCALE),link=(0,utils_1.buildTitleUrl)(item.id,slug,baseUrl),name=(0,utils_1.resolveTitleName)(item,utils_1.DEFAULT_LOCALE),image=(0,utils_1.pickImageByType)(null==item?void 0:item.images,cdnUrl,["poster","cover","background"]),year=extractYear((null==item?void 0:item.release_date)||(null==item?void 0:item.last_air_date));return{title:name,link:link,image:image||void 0,type:"tv"===String((null==item?void 0:item.type)||"").toLowerCase()?"series":"movie",year:year}}).filter(item=>!!item&&!!item.title&&!!item.link);return related.length>0?related:void 0},getMeta=function(_a){return __awaiter(this,arguments,void 0,function*({link:link,providerContext:providerContext}){var _b,_c,_d,_e;try{const{cheerio:cheerio}=providerContext,baseUrl=yield(0,utils_1.resolveBaseUrl)(providerContext),titleId=(0,utils_1.extractTitleId)(link);if(!titleId)throw new Error("Invalid title id");const slugFromLink=extractSlugFromLink(link),url=(0,utils_1.buildLocaleUrl)(buildTitlePath(titleId,slugFromLink),baseUrl),html=yield fetchHtml(url,providerContext),page=(0,utils_1.extractInertiaPage)(html,cheerio),title=null===(_b=null==page?void 0:page.props)||void 0===_b?void 0:_b.title;if(!title)throw new Error("Missing title data");const slug=(0,utils_1.resolveTitleSlug)(title,utils_1.DEFAULT_LOCALE)||slugFromLink,cdnUrl=(null===(_c=null==page?void 0:page.props)||void 0===_c?void 0:_c.cdn_url)||DEFAULT_CDN_URL,titleName=(0,utils_1.resolveTitleName)(title,utils_1.DEFAULT_LOCALE),plot=(0,utils_1.getTranslationValue)(null==title?void 0:title.translations,"plot",utils_1.DEFAULT_LOCALE)||String((null==title?void 0:title.plot)||""),poster=(0,utils_1.pickImageByType)(null==title?void 0:title.images,cdnUrl,["poster","cover","cover_mobile","background"]),logo=(0,utils_1.pickImageByType)(null==title?void 0:title.images,cdnUrl,["logo"]),background=(0,utils_1.pickImageByType)(null==title?void 0:title.images,cdnUrl,["background","cover","cover_mobile"]),genres=normalizeGenres((null==title?void 0:title.genres)||[]),keywords=normalizeKeywords((null==title?void 0:title.keywords)||[]),tags=mergeTags(genres,keywords),cast=normalizePeople((null==title?void 0:title.main_actors)||[]),directors=normalizePeople((null==title?void 0:title.main_directors)||[]),releaseDate=(null==title?void 0:title.release_date_it)||(null==title?void 0:title.release_date),lastAirDate=(null==title?void 0:title.last_air_date_it)||(null==title?void 0:title.last_air_date),year=extractYear(releaseDate||lastAirDate),runtime=normalizeRuntime(null==title?void 0:title.runtime),rating=null!=(null==title?void 0:title.score)?String(title.score):"",type="tv"===String((null==title?void 0:title.type)||"").toLowerCase()?"series":"movie",related=buildRelated((null===(_d=null==page?void 0:page.props)||void 0===_d?void 0:_d.sliders)||[],baseUrl,cdnUrl);let episodesCount,linkList=[];if("series"===type){const seriesLinks=yield buildSeriesLinks({title:title,slug:slug,baseUrl:baseUrl,loadedSeason:null===(_e=null==page?void 0:page.props)||void 0===_e?void 0:_e.loadedSeason,providerContext:providerContext});linkList=seriesLinks.linkList,episodesCount=seriesLinks.episodesCount}else{linkList=[{title:"Play",titleKey:"Play",directLinks:[{title:"Play",titleKey:"Play",link:(0,utils_1.buildTitleUrl)(titleId,slug,baseUrl),type:"movie"}]}]}const viewsRaw=(null==title?void 0:title.views_it)||(null==title?void 0:title.views);(null==title?void 0:title.daily_views_it)||(null==title||title.daily_views);return{title:titleName,synopsis:(0,utils_1.normalizeText)(plot||""),image:poster||background||"",logo:logo||void 0,background:background||poster||void 0,poster:poster||void 0,imdbId:String((null==title?void 0:title.imdb_id)||""),year:year||void 0,runtime:runtime||void 0,country:(null==title?void 0:title.country)||void 0,director:directors[0]||void 0,type:type,tags:tags.length>0?tags:void 0,genres:genres.length>0?genres:void 0,cast:cast.length>0?cast:void 0,rating:rating||void 0,episodesCount:episodesCount,extra:{ids:{netflixId:(null==title?void 0:title.netflix_id)||void 0,primeId:(null==title?void 0:title.prime_id)||void 0,disneyId:(null==title?void 0:title.disney_id)||void 0},stats:{scoreRaw:null!=(null==title?void 0:title.score)?String(title.score):void 0,views:toNumber(viewsRaw),members:void 0,favorites:void 0,episodesCountRaw:(null==title?void 0:title.seasons_count)||void 0},flags:{dub:(null==title?void 0:title.dub_ita)||void 0},meta:{status:(null==title?void 0:title.status)||void 0,type:(null==title?void 0:title.type)||void 0,createdAt:(null==title?void 0:title.created_at)||void 0}},related:related,linkList:linkList}}catch(err){return{title:"",synopsis:"",image:"",imdbId:"",type:"movie",linkList:[]}}})};exports.getMeta=getMeta;
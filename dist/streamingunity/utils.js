"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.normalizeText=exports.buildTitleUrl=exports.extractTitleId=exports.pickImageByType=exports.buildImageUrl=exports.resolveTitleSlug=exports.resolveTitleName=exports.getTranslationValue=exports.extractInertiaPage=exports.decodeHtmlEntities=exports.buildLocaleUrl=exports.resolveUrl=exports.buildLocalePath=exports.resolveBaseUrl=exports.normalizeBaseUrl=exports.REQUEST_TIMEOUT=exports.DEFAULT_LOCALE=exports.DEFAULT_BASE_URL=void 0,exports.DEFAULT_BASE_URL="https://streamingunity.tv",exports.DEFAULT_LOCALE="it",exports.REQUEST_TIMEOUT=15e3;const normalizeBaseUrl=value=>value.replace(/\/+$/,"");exports.normalizeBaseUrl=normalizeBaseUrl;const resolveBaseUrl=providerContext=>__awaiter(void 0,void 0,void 0,function*(){try{const resolved=yield providerContext.getBaseUrl("streamingunity");if(resolved)return(0,exports.normalizeBaseUrl)(resolved)}catch(_){}return exports.DEFAULT_BASE_URL});exports.resolveBaseUrl=resolveBaseUrl;const withLeadingSlash=value=>value.startsWith("/")?value:`/${value}`,buildLocalePath=path=>{const normalized=path?withLeadingSlash(path.trim()):"";return normalized&&"/"!==normalized?normalized.startsWith(`/${exports.DEFAULT_LOCALE}/`)||normalized===`/${exports.DEFAULT_LOCALE}`?normalized:`/${exports.DEFAULT_LOCALE}${normalized}`:`/${exports.DEFAULT_LOCALE}`};exports.buildLocalePath=buildLocalePath;const resolveUrl=(href,baseUrl)=>href?/^https?:\/\//i.test(href)?href:new URL(href,baseUrl).href:"";exports.resolveUrl=resolveUrl;const buildLocaleUrl=(path,baseUrl)=>(0,exports.resolveUrl)((0,exports.buildLocalePath)(path),baseUrl);exports.buildLocaleUrl=buildLocaleUrl;const decodeHtmlEntities=value=>value.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");exports.decodeHtmlEntities=decodeHtmlEntities;const extractInertiaPage=(html,cheerio)=>{if(!html)return null;const $=cheerio.load(html),raw=$("#app[data-page]").first().attr("data-page")||$("div[data-page]").first().attr("data-page")||"";if(!raw)return null;const decoded=(0,exports.decodeHtmlEntities)(raw);try{return JSON.parse(decoded)}catch(_){try{return JSON.parse((0,exports.decodeHtmlEntities)(decoded))}catch(err){return null}}};exports.extractInertiaPage=extractInertiaPage;const getTranslationValue=(translations,key,locale=exports.DEFAULT_LOCALE)=>{if(!Array.isArray(translations))return"";const match=translations.find(item=>item&&item.key===key&&item.locale===locale);return(null==match?void 0:match.value)?String(match.value).trim():""};exports.getTranslationValue=getTranslationValue;const resolveTitleName=(title,locale=exports.DEFAULT_LOCALE)=>{const translations=null==title?void 0:title.translations,translated=(0,exports.getTranslationValue)(translations,"name",locale);if(translated)return translated;if("en"!==locale){const english=(0,exports.getTranslationValue)(translations,"name","en");if(english)return english}const normalizedSlug=(value=>{const raw=String(value||"").trim();if(!raw)return"";const normalized=raw.replace(/[-_]+/g," ").replace(/\s+/g," ").trim();return normalized?normalized.split(" ").map(word=>word?word[0].toUpperCase()+word.slice(1):"").join(" "):""})((0,exports.getTranslationValue)(translations,"slug",locale)||(0,exports.getTranslationValue)(translations,"slug","en")||String((null==title?void 0:title.slug)||"").trim());if(normalizedSlug)return normalizedSlug;const fallback=(null==title?void 0:title.name)||(null==title?void 0:title.original_name)||"";return String(fallback||"").trim()};exports.resolveTitleName=resolveTitleName;const resolveTitleSlug=(title,locale=exports.DEFAULT_LOCALE)=>(0,exports.getTranslationValue)(null==title?void 0:title.translations,"slug",locale)||String((null==title?void 0:title.slug)||"").trim();exports.resolveTitleSlug=resolveTitleSlug;const buildImageUrl=(image,cdnUrl)=>{if(!image)return"";const raw=image.original_url_field||image.url||image.src||image.path||image.filename||"";if(!raw)return"";if(/^https?:\/\//i.test(raw))return raw;const normalizedCdn=cdnUrl?cdnUrl.replace(/\/+$/,""):"";return normalizedCdn?`${normalizedCdn}/images/${String(raw).replace(/^\/+/,"")}`:raw};exports.buildImageUrl=buildImageUrl;const pickImageByType=(images,cdnUrl,types,locale=exports.DEFAULT_LOCALE)=>{if(!Array.isArray(images)||0===images.length)return"";const normalizedTypes=types.map(type=>type.toLowerCase());for(const type of normalizedTypes){const matches=images.filter(img=>String((null==img?void 0:img.type)||"").toLowerCase()===type);if(0===matches.length)continue;const fallback=matches.find(img=>String((null==img?void 0:img.lang)||"").toLowerCase()===locale)||matches.find(img=>!(null==img?void 0:img.lang))||matches[0],url=(0,exports.buildImageUrl)(fallback,cdnUrl);if(url)return url}const fallback=images[0];return(0,exports.buildImageUrl)(fallback,cdnUrl)};exports.pickImageByType=pickImageByType;const extractTitleId=value=>{if(!value)return"";const cleaned=value.split("::")[0],match=cleaned.match(/\/(?:titles|watch)\/(\d+)/i)||cleaned.match(/^(\d+)$/);return(null==match?void 0:match[1])||""};exports.extractTitleId=extractTitleId;const buildTitleUrl=(titleId,slug,baseUrl)=>{const id=String(titleId||"").trim();if(!id)return"";const safeSlug=slug?`-${slug}`:"";return(0,exports.buildLocaleUrl)(`/titles/${id}${safeSlug}`,baseUrl)};exports.buildTitleUrl=buildTitleUrl;const normalizeText=value=>String(value||"").replace(/\s+/g," ").trim();exports.normalizeText=normalizeText;